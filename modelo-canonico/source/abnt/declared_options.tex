%%%%%%%%%%%%%      OPTION DECLARATION      %%%%%%%%%%%%

%% Page numbering scheme
\providecommand{\ABNTpnum}{}
\DeclareOption{pagestart=folhaderosto} {\renewcommand{\ABNTpnum}{ABNT}}
\DeclareOption{pagestart=sumario}      {\renewcommand{\ABNTpnum}{plain}}
\DeclareOption{pagestart=firstchapter} {\renewcommand{\ABNTpnum}{RomSumArab}}
%deprecated options
\DeclareOption{pnumabnt}        {\ExecuteOptions{pagestart=folhaderosto}}
\DeclareOption{pnumplain}       {\ExecuteOptions{pagestart=sumario}}
\DeclareOption{pnumromarab}     {\ExecuteOptions{pagestart=firstchapter}}

%% Automatically include in TOC bibliography, index and stared chapters
\newboolean{ABNTincludeintoc}
\DeclareOption{sumario=completo}   {\setboolean{ABNTincludeintoc}{true}}
\DeclareOption{sumario=incompleto} {\setboolean{ABNTincludeintoc}{false}}
%deprecated options
\DeclareOption{sumariocompleto}    {\ExecuteOptions{sumario=completo}}
\DeclareOption{sumarioincompleto}  {\ExecuteOptions{sumario=incompleto}}

%% Style of page numbers in TOC
\newboolean{ABNTpagenumstyle}
\DeclareOption{tocpage=prefix} {\setboolean{ABNTpagenumstyle}{true}}
\DeclareOption{tocpage=plain}  {\setboolean{ABNTpagenumstyle}{false}}
%deprecated options
\DeclareOption{abnttoc}      {\ExecuteOptions{tocpage=prefix}}
\DeclareOption{normaltoc}    {\ExecuteOptions{tocpage=plain}}

%% Figures and tables independent of sections?

\newboolean{ABNTfigtabnumbers}
\DeclareOption{floatnumber=continuous} {\setboolean{ABNTfigtabnumbers}{true}}
\DeclareOption{floatnumber=chapter}    {\setboolean{ABNTfigtabnumbers}{false}}
%deprecated options
\DeclareOption{normalfigtabnum} {\ExecuteOptions{floatnumber=chapter}}
\DeclareOption{abntfigtabnum}   {\ExecuteOptions{floatnumber=continuous}}

%% Option: page headers
\newboolean{ABNTheader}
\providecommand{\ABNTheadertype}{\relax}
\DeclareOption{header=no}      {\setboolean{ABNTheader}{false}}
\DeclareOption{header=yes}     {\setboolean{ABNTheader}{true}}
\DeclareOption{header=normal}  {\ExecuteOptions{header=yes}\renewcommand{\ABNTheadertype}{normal}}
\DeclareOption{header=plain}   {\ExecuteOptions{header=yes}\renewcommand{\ABNTheadertype}{plain}}
\DeclareOption{header=ruled}   {\ExecuteOptions{header=yes}\renewcommand{\ABNTheadertype}{ruled}}
%%deprecated options
\DeclareOption{noheader}    {\ExecuteOptions{header=none}}
\DeclareOption{header}      {\ExecuteOptions{header=normal}}
\DeclareOption{plainheader} {\ExecuteOptions{header=plain}}
\DeclareOption{ruledheader} {\ExecuteOptions{header=ruled}}

%% Option `capchap', `capsec': 
%%   titles of chapters or sections in capital letters 
\newboolean{ABNTcapchap}              %true=titles of chapter/appendix in uppercase
\newboolean{ABNTcapsec}               %true=titles of sections in uppercase
\newboolean{ABNTCapAnnexAppendix}     %true=appendixname in uppercase
\newboolean{ABNTAnApName}             %true=show appendixname
\newboolean{ABNTAnApIndicativoIndent} %true=typeset title in a vbox

\ExecuteOptions{anapindicindent}
\DeclareOption{appendix=noname}     {\setboolean{ABNTAnApName}{false}}
\DeclareOption{appendix=Name}       {\setboolean{ABNTCapAnnexAppendix}{false}\setboolean{ABNTAnApName}{true}}
\DeclareOption{appendix=NAME}       {\setboolean{ABNTCapAnnexAppendix}{true}\setboolean{ABNTAnApName}{true}}
\DeclareOption{appendix=titlebox}   {\setboolean{ABNTAnApIndicativoIndent}{true}}
\DeclareOption{appendix=notitlebox} {\setboolean{ABNTAnApIndicativoIndent}{false}}
\DeclareOption{chapter=TITLE}       {\setboolean{ABNTcapchap}{true}\ExecuteOptions{appendix=NAME}}
\DeclareOption{chapter=Title}       {\setboolean{ABNTcapchap}{false}}
\DeclareOption{section=TITLE}       {\setboolean{ABNTcapsec}{true}}
\DeclareOption{section=Title}       {\setboolean{ABNTcapsec}{false}}
%%deprecated options
\DeclareOption{capchap}         {\ExecuteOptions{chapter=TITLE,appendix=NAME}}
\DeclareOption{capsec}          {\ExecuteOptions{section=TITLE}}
\DeclareOption{anapmaiusc}      {\ExecuteOptions{appendix=TITLE}}
\DeclareOption{anapnormal}      {\ExecuteOptions{appendix=Title}}
\DeclareOption{anapname}        {\ExecuteOptions{appendix=Name}}
\DeclareOption{anapnoname}      {\ExecuteOptions{appendix=noname}}
\DeclareOption{anapindicindent} {\ExecuteOptions{appendix=titlebox}}
\DeclareOption{anapcustomindent}{\ExecuteOptions{appendix=notitlebox}}

%% Line Spacing options: change current setting.
\newcommand*{\ABNTespacodefault}{} %
\DeclareOption{espaco=umemeio} {\renewcommand*{\ABNTespacodefault}{\taxaespacoumemeio}} % default
\DeclareOption{espaco=simples} {\renewcommand*{\ABNTespacodefault}{\taxaespacosimples}}
\DeclareOption{espaco=duplo}   {\renewcommand*{\ABNTespacodefault}{\taxaespacoduplo}}
%deprecated options
\DeclareOption{espacoumemeio} {\ExecuteOptions{espaco=umemeio}}
\DeclareOption{espacosimples} {\ExecuteOptions{espaco=simples}}
\DeclareOption{espacoduplo}   {\ExecuteOptions{espaco=duplo}}

%% Margin care --> Removed since version 1 beta

%% Options `spacednotes': removed since version 0.3
%  Assuming notes single spaced always (no alternative if using setspace ;-D

%% Auto bold math: bold math version ir text font is in bold face
\newboolean{ABNTautobm}
\DeclareOption{boldmath=auto}   {\setboolean{ABNTautobm}{true}}
\DeclareOption{boldmath=noauto} {\setboolean{ABNTautobm}{false}}
%deprecated options
\DeclareOption{autobm}   {\ExecuteOptions{boldmath=auto}}
\DeclareOption{noautobm} {\ExecuteOptions{boldmath=noauto}}

%% font option: times as default or not
\newboolean{ABNTtimesfont}
\DeclareOption{font=times}   {\setboolean{ABNTtimesfont}{true}}
\DeclareOption{font=plain}   {\setboolean{ABNTtimesfont}{false}}
%
\DeclareOption{times}   {\ExecuteOptions{font=times}}
\DeclareOption{notimes} {\ExecuteOptions{font=plain}}

%% Option to indent the first paragraph of each section or chapter
\newboolean{ABNTindentfirst}
\DeclareOption{indent=all}       {\setboolean{ABNTindentfirst}{true}}
\DeclareOption{indent=firstonly} {\setboolean{ABNTindentfirst}{false}}
%deprecated options
\DeclareOption{indentfirst}   {\ExecuteOptions{indent=all}}
\DeclareOption{noindentfirst} {\ExecuteOptions{indent=firstonly}}

%Options which group options according to specific norms.

%TODO AJUSTAR\DeclareOption{nbr6027=1989}  {\input{nbr6027-1989.def}}
%TODO AJUSTAR \DeclareOption{nbr14724=2001} {\input{nbr14724-2001.def}}
  
%options which declare version specific behaviour,
%default options expected for each version are declared here

\DeclareOption{abntex=0.8} 
  {\ExecuteOptions{boldmath=auto}
   \ExecuteOptions{font=times}
   \ExecuteOptions{nbr6027=1989,nbr14724=2001}
   \renewcommand{\ABNTbibliographyname}{\refname}}

\DeclareOption{abntex=0.9} 
  {\ExecuteOptions{boldmath=auto}
   \ExecuteOptions{font=times}
   \ExecuteOptions{nbr6027=1989,nbr14724=2001}}

% This should be the only default \ExecuteOptions command.
\ExecuteOptions{abntex=0.9}

\def\ABNTcurrentoptions{}
\newcommand{\AddCurrentOptionToList}{%
  \ifx\ABNTcurrentoptions\@empty%
     \edef\ABNTcurrentoptions{\CurrentOption}%
  \else%
     \edef\ABNTcurrentoptions{\ABNTcurrentoptions,\CurrentOption}%
  \fi%
}

%% All options not defined are passed to `report'
\DeclareOption*{%
  \AddCurrentOptionToList
% if some font or paper option is passed, a flag is set.
  \ifthenelse{\equal{\CurrentOption}{10pt}\or\equal{\CurrentOption}{11pt}}%
    {\setboolean{ABNTfontsize}{true}}{}%
  \ifthenelse{\equal{\CurrentOption}{a5paper}\or%
              \equal{\CurrentOption}{b5paper}\or%
              \equal{\CurrentOption}{letterpaper}}%
    {\setboolean{ABNTpaper}{true}}{}%
  \ifthenelse{\equal{\CurrentOption}{openany}}%
    {\setboolean{ABNTopen}{true}}{}%
  \PassOptionsToClass{\CurrentOption}{report}}


% testing if user use other options for font size or paper
% than 12pt, a4paper and openright
\newboolean{ABNTfontsize}
\setboolean{ABNTfontsize}{false}
\newboolean{ABNTpaper}
\setboolean{ABNTpaper}{false}
\newboolean{ABNTopen}
\setboolean{ABNTopen}{false}

% Process options (without star -> in the order of definition!).
\ProcessOptions